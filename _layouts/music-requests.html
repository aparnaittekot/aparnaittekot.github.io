---
layout: page
# The Archives of music.
---

<style>
.music-layout {
  display: block;
  margin: 2.5rem auto;
  max-width: 1200px;
  position: relative;
}
.music-table-section {
  width: 100%;
  background: #23272f;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.13);
  padding: 1.2rem 1rem 1.5rem 1rem;
  color: #fff;
  margin-bottom: 2.5rem;
  overflow-x: auto;
}
.music-form-section {
  max-width: 420px;
  margin: 0 auto;
  background: #23272f;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.13);
  padding: 1.2rem 1rem 1.5rem 1rem;
  color: #fff;
}
.music-title {
  font-size: 1.2em;
  font-weight: 700;
  margin-bottom: 1em;
  text-align: left;
}
.music-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-bottom: 1.5rem;
  background: #181818;
  border-radius: 10px;
  overflow: hidden;
  font-size: 0.98em;
  table-layout: auto;
}
.music-table th, .music-table td {
  padding: 0.55em 0.6em;
  border-bottom: 1px solid #333;
  text-align: left;
  font-size: 0.97em;
  vertical-align: top;
}
.music-table th {
  color: #b3b3b3;
  font-weight: 700;
  background: #23272f;
  border-bottom: 2px solid #23272f;
}
.music-table tr:last-child td {
  border-bottom: none;
}
.music-table td {
  color: #fff;
  background: #181818;
  border-bottom: 1px solid #23272f;
}
.music-table thead th:first-child,
.music-table tbody td:first-child {
  border-top-left-radius: 10px;
}
.music-table thead th:last-child,
.music-table tbody td:last-child {
  border-top-right-radius: 10px;
}
.music-form label {
  color: #fff;
  font-weight: 600;
  font-size: 1em;
  margin-bottom: 0.2em;
}
.music-form input,
.music-form select,
.music-form textarea {
  padding: 0.5em 0.8em;
  border-radius: 7px;
  border: 1px solid #444;
  background: #181818;
  color: #fff;
  font-size: 0.98em;
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 0.7em;
}
.music-form textarea {
  resize: vertical;
}
.music-form button {
  background: #1db954;
  color: #fff;
  font-weight: 700;
  font-size: 1em;
  padding: 0.6em 0;
  border: none;
  border-radius: 7px;
  transition: background 0.2s;
  cursor: pointer;
  margin-top: 0.3em;
  width: 100%;
}
.music-status {
  min-height: 1.2em;
  font-size: 0.98em;
  color: #b3b3b3;
  margin-top: 0.2em;
  text-align: center;
}
.music-popup-btn {
  position: static;
  margin: 1.2rem 0 1.2rem 0;
  display: block;
  background: #181818;
  color: #fff;
  border: none;
  border-radius: 7px;
  padding: 0.7em 1.5em;
  font-weight: 700;
  font-size: 1em;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(0,0,0,0.13);
  transition: background 0.2s;
}
.music-popup-btn:hover {
  background: #1db954;
  color: #fff;
}
.music-popup-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  width: 100vw;
  height: 100vh;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  background: rgba(0,0,0,0.45);
}
.music-popup-overlay.active {
  display: flex;
}
.music-popup-content {
  background: #23272f;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.18);
  padding: 2.2rem 2rem 2.5rem 2rem;
  color: #fff;
  max-width: 420px;
  width: 95vw;
  position: relative;
  margin: 0;
  animation: popupIn 0.25s cubic-bezier(.4,2,.6,1);
  /* Centered by flexbox parent */
}
@keyframes popupIn {
  from { opacity: 0; transform: translateY(-40px);}
  to { opacity: 1; transform: translateY(0);}
}
.music-popup-close {
  position: absolute;
  top: 1.1rem;
  right: 1.2rem;
  background: none;
  border: none;
  color: #fff;
  font-size: 1.5em;
  cursor: pointer;
  font-weight: 700;
  z-index: 1002;
}
@media (max-width: 900px) {
  .music-layout {
    flex-direction: column;
    gap: 1.5rem;
  }
  .music-table-section, .music-form-section {
    max-width: 100%;
    min-width: 0;
    padding: 1.2rem 0.7rem 1.5rem 0.7rem;
  }
  .music-table th, .music-table td {
    font-size: 0.95em;
    padding: 0.45em 0.4em;
  }
}
</style>

<div class="music-layout">
  <button id="music-popup-btn" class="music-popup-btn" type="button">Music Request Submission Form</button>
  <div id="music-popup-overlay" class="music-popup-overlay">
    <div class="music-popup-content">
      <button class="music-popup-close" id="music-popup-close" title="Close">&times;</button>
      <div class="music-title" style="text-align:center;">Music Request Details</div>
      <form id="music-form" class="music-form" autocomplete="off">
        <label for="topic">What is the topic of the request?<span style="color:#ff6666">*</span> </label>
        <input id="topic" name="topic" type="text" required placeholder="e.g. Explain Circle of Fifths In Simple Terms">
      
        <label for="contentType">Is this music theory, cover or something else?<span style="color:#ff6666">*</span></label>
        <div style="display:flex;gap:0.5em;align-items:center;">
          <select id="contentType" name="contentType" required style="flex:1;">
            <option value="">Select</option>
            <option value="Music Theory">Music Theory</option>
            <option value="Music Cover">Music Cover</option>
            <option value="Custom">Others (Custom)</option>
          </select>
          <input id="customContentType" name="customContentType" type="text" placeholder="Add a custom input" style="flex:1;display:none;">
        </div>

        <label for="resourceType">How do you want this released?<span style="color:#ff6666">*</span></label>
        <select id="resourceType" name="resourceType" required>
          <option value="">Select</option>
          <option value="VIDEO">YouTube Video</option>
          <option value="BLOG">Blog</option>
        </select>

        <label for="instrument">Which instrument do you prefer for this?<span style="color:#ff6666">*</span></label>
        <select id="instrument" name="instrument" required>
          <option value="">Select</option>
          <option value="ANY">Any</option>
          <option value="PIANO">Piano</option>
          <option value="ACOUSTIC_GUITAR">Acoustic Guitar</option>
          <option value="ELECTRIC_GUITAR">Electric Guitar</option>
        </select>

        <label for="description">[Optional] Detailed description</label>
        <textarea id="description" name="description" rows="2" placeholder="Add more details regarding the content if you have any"></textarea>

        <button type="submit">Submit</button>
        <div id="music-status" class="music-status"></div>
      </form>
    </div>
  </div>
  <div class="music-table-section">
    <div style="margin-bottom:1.2em;display:flex;align-items:center;gap:0.7em;">
      <input id="music-search" type="text" placeholder="Search requests..." style="flex:1;max-width:340px;padding:0.5em 1em;border-radius:7px;border:1px solid #444;background:#181818;color:#fff;">
      <button id="music-search-btn" style="background:#1db954;color:#fff;border:none;padding:0.5em 1.2em;border-radius:7px;font-weight:600;cursor:pointer;">Search</button>
      <button id="music-search-clear" type="button" style="margin-left:0.5em;background:#444;color:#fff;border:none;padding:0.5em 1.2em;border-radius:7px;font-weight:600;cursor:pointer;">Clear</button>
    </div>
    <table class="music-table" id="music-table">
      <thead>
        <tr>
          <th></th>
          <th>Topic</th>
          <th>Topic Type</th>
          <th>Release Mode</th>
          <th>Instrument</th>
          <th>Description</th>
          <th>Release Date</th>
        </tr>
      </thead>
      <tbody id="music-table-body">
        <!-- JS will populate rows here -->
      </tbody>
    </table>
  </div>
</div>

<script>
// API endpoints
const API_WRITE = 'https://musiccontentapi.onrender.com/create';
const API_READ = 'https://musiccontentapi.onrender.com/all';
const API_SEARCH = 'https://musiccontentapi.onrender.com/search';

document.addEventListener('DOMContentLoaded', function() {
  // Popup logic
  const popupBtn = document.getElementById('music-popup-btn');
  const popupOverlay = document.getElementById('music-popup-overlay');
  const popupClose = document.getElementById('music-popup-close');

  if (popupBtn && popupOverlay && popupClose) {
    popupBtn.addEventListener('click', function() {
      popupOverlay.classList.add('active');
      setTimeout(() => {
        document.getElementById('topic').focus();
      }, 200);
    });
    popupClose.addEventListener('click', function() {
      popupOverlay.classList.remove('active');
    });
    popupOverlay.addEventListener('click', function(e) {
      if (e.target === popupOverlay) popupOverlay.classList.remove('active');
    });
  }

  // Search logic
  const searchInput = document.getElementById('music-search');
  const searchBtn = document.getElementById('music-search-btn');
  const searchClearBtn = document.getElementById('music-search-clear');

  if (searchBtn && searchInput) {
    searchBtn.addEventListener('click', function() {
      doSearch();
    });
    searchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        doSearch();
      }
    });
  }
  if (searchClearBtn && searchInput) {
    searchClearBtn.addEventListener('click', function() {
      searchInput.value = '';
      searchInput.focus();
      loadMusicTopics();
    });
  }

  // Form logic
  const musicForm = document.getElementById('music-form');
  if (musicForm) {
    musicForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const statusDiv = document.getElementById('music-status');
      statusDiv.textContent = 'Submitting...';

      const data = {
        content_key: document.getElementById('topic').value.trim(),
        content_type: getContentTypeValue(),
        resource_type: getResourceTypeValue(),
        instrument: getInstrumentValue(),
        description: document.getElementById('description').value.trim()
      };

      try {
        const resp = await fetch(API_WRITE, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (resp.ok) {
          statusDiv.textContent = 'Thank you! Your suggestion was submitted.';
          this.reset();
          setTimeout(() => { statusDiv.textContent = ''; }, 2000);
          setTimeout(loadMusicTopics, 800);
          popupOverlay.classList.remove('active');
        } else {
          statusDiv.textContent = 'Failed to submit. Please try again later.';
        }
      } catch {
        statusDiv.textContent = 'Failed to submit. Please try again later.';
      }
    });
  }

  // Custom content type logic
  const contentTypeSelect = document.getElementById('contentType');
  const customContentTypeInput = document.getElementById('customContentType');
  const resourceTypeSelect = document.getElementById('resourceType');
  if (contentTypeSelect && customContentTypeInput && resourceTypeSelect) {
    contentTypeSelect.addEventListener('change', function() {
      if (this.value.toLowerCase() === 'custom') {
        customContentTypeInput.style.display = '';
        customContentTypeInput.required = true;
      } else {
        customContentTypeInput.style.display = 'none';
        customContentTypeInput.required = false;
        customContentTypeInput.value = '';
      }
      if (this.value === 'Music Cover') {
        resourceTypeSelect.value = 'YouTube Video';
        resourceTypeSelect.disabled = true;
      } else {
        resourceTypeSelect.disabled = false;
      }
    });
  }

  // Initial load
  setTimeout(loadMusicTopics, 1);
});

// Resource type and instrument value mapping
const resourceTypeSelect = document.getElementById('resourceType');
const instrumentSelect = document.getElementById('instrument');

// Utility: Map display values to API values for writing
function getResourceTypeValue() {
  const v = resourceTypeSelect.value;
  if (v === 'YouTube Video' || v === 'VIDEO') return 'VIDEO';
  if (v === 'Blog' || v === 'BLOG') return 'BLOG';
  return v;
}
function getInstrumentValue() {
  const v = instrumentSelect.value;
  if (v === 'Piano' || v === 'PIANO') return 'PIANO';
  if (v === 'Acoustic Guitar' || v === 'ACOUSTIC_GUITAR') return 'ACOUSTIC_GUITAR';
  if (v === 'Electric Guitar' || v === 'ELECTRIC_GUITAR') return 'ELECTRIC_GUITAR';
  if (v === 'Any' || v === 'ANY') return null;
  return v;
}
function getContentTypeValue() {
  let v = contentTypeSelect.value;
  if (v.toLowerCase() === 'custom') {
    v = customContentTypeInput.value.trim();
  }
  return displayContentType(v);
}

// Map API values to display values for reading
function displayResourceType(v) {
  if (v === 'VIDEO') return 'YouTube Video';
  if (v === 'BLOG') return 'Blog';
  return v || '';
}
function displayInstrument(v) {
  if (v === 'PIANO') return 'Piano';
  if (v === 'ACOUSTIC_GUITAR') return 'Acoustic Guitar';
  if (v === 'ELECTRIC_GUITAR') return 'Electric Guitar';
  if (!v || v === 'ANY' || v === null) return 'Any';
  return v;
}
function displayContentType(v) {
   return v
    .split(/[^a-zA-Z0-9]+/)             // split by non-alphanumeric chars
    .filter(Boolean)                    // remove empty strings
    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()) // capitalize
    .join(' ');
}

// Handle custom content type input visibility and value
const contentTypeSelect = document.getElementById('contentType');
const customContentTypeInput = document.getElementById('customContentType');

contentTypeSelect.addEventListener('change', function() {
  if (this.value.toLowerCase() === 'custom') {
    customContentTypeInput.style.display = '';
    customContentTypeInput.required = true;
  } else {
    customContentTypeInput.style.display = 'none';
    customContentTypeInput.required = false;
    customContentTypeInput.value = '';
  }
});

// Handle form submission (write)
document.getElementById('music-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const statusDiv = document.getElementById('music-status');
  statusDiv.textContent = 'Submitting...';

  const data = {
    content_key: document.getElementById('topic').value.trim(),
    content_type: getContentTypeValue(),
    resource_type: getResourceTypeValue(),
    instrument: getInstrumentValue(),
    description: document.getElementById('description').value.trim()
  };

  try {
    const resp = await fetch(API_WRITE, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (resp.ok) {
      statusDiv.textContent = 'Thank you! Your suggestion was submitted.';
      this.reset();
      setTimeout(() => { statusDiv.textContent = ''; }, 2000);
      setTimeout(loadMusicTopics, 800);
      popupOverlay.classList.remove('active');
    } else {
      statusDiv.textContent = 'Currently unavailable to submit form. Alternatively, you can submit here : https://forms.gle/Qi5CJ686goWrkeUY9';
    }
  } catch {
    statusDiv.textContent = 'Currently unavailable to submit form. Alternatively, you can submit here : https://forms.gle/Qi5CJ686goWrkeUY9';
  }
});

// Fetch topics from API (read)
async function fetchMusicTopics() {
  try {
    const resp = await fetch(API_READ);
    if (!resp.ok) return [];
    return await resp.json();
  } catch {
    return [];
  }
}

// Render table rows
function renderMusicTable(topics) {
  const tbody = document.getElementById('music-table-body');
  tbody.innerHTML = '';
  if (!topics.length) {
    tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">No music requests so far.</td></tr>';
    return;
  }
  topics.forEach(row => {
    let tick = '';
    if (row.status && row.status.toUpperCase() === 'RELEASED') {
      tick = '✅';
    } else if (row.status) {
      tick = '';
    } else {
      tick = '';
    }
    // Map "date" to "Release Date" and show "Not Set" if null/empty
    let releaseDate = row.date ? row.date.split('T')[0] : 'Not Set';
    // If link is present, hyperlink the topic
    let topicCell = row.content_key || '';
    if (row.link) {
      topicCell = `<a href="${row.link}" target="_blank" rel="noopener">${topicCell}</a>`;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="text-align:center;">${tick}</td>
      <td>${topicCell}</td>
      <td>${displayContentType(row.content_type)}</td>
      <td>${displayResourceType(row.resource_type)}</td>
      <td>${displayInstrument(row.instrument)}</td>
      <td>${row.description || ''}</td>
      <td>${releaseDate}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Load and render topics
async function loadMusicTopics() {
  // Render loading state immediately
  const tbody = document.getElementById('music-table-body');
  tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">Loading...</td></tr>';
  try {
    // Fetch in parallel, then render
    const topics = await fetchMusicTopics();
    renderMusicTable(topics);
  } catch {
    tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">Music requests are temporarily unavailable. If you are looking to submit a request, here is an alternate link : https://forms.gle/Qi5CJ686goWrkeUY9</td></tr>';
  }
}

// Fetch topics as soon as possible
document.addEventListener('DOMContentLoaded', () => {
  // Start loading immediately, don't wait for all DOM
  setTimeout(loadMusicTopics, 1);
});

// Search logic
const searchInput = document.getElementById('music-search');
const searchBtn = document.getElementById('music-search-btn');
const searchClearBtn = document.getElementById('music-search-clear');

searchBtn.addEventListener('click', function() {
  doSearch();
});
searchInput.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    doSearch();
  }
});
searchClearBtn.addEventListener('click', function() {
  searchInput.value = '';
  searchInput.focus();
  loadMusicTopics();
});

async function doSearch() {
  const q = searchInput.value.trim();
  const tbody = document.getElementById('music-table-body');
  if (!q) {
    loadMusicTopics();
    return;
  }
  tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">Searching...</td></tr>';
  try {
    const resp = await fetch(`${API_SEARCH}?query=${encodeURIComponent(q)}`);
    if (!resp.ok) {
      tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">Search failed.</td></tr>';
      return;
    }
    const topics = await resp.json();
    if (!topics.length) {
      tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">No requests matching your search query.</td></tr>';
      return;
    }
    renderMusicTable(topics);
  } catch {
    tbody.innerHTML = '<tr><td colspan="7" style="color:#b3b3b3;text-align:center;">Search failed.</td></tr>';
  }
}
</script>
